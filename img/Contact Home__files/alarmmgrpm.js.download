/*<ORACLECOPYRIGHT>
* Copyright (C) 2008-2016
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
/* 16.10.0.0SIA[23057]PATCHSET10 */
typeof SiebelAppFacade.AlarmMgrPM=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.AlarmMgrPM"),define("siebel/alarmmgrpm",[],function(){return SiebelAppFacade.AlarmMgrPM=function(){function i(e){SiebelAppFacade.AlarmMgrPM.superclass.constructor.call(this,e)}function s(){this.Get("pollId").length>0&&clearTimeout(this.Get("pollId")),d.call(this)}function o(t){var n=arguments[arguments.length-1];if(n&&n instanceof Object){var r=e.get("SWE_EXTN_RETVAL"),i=e.get("SWE_EXTN_CANCEL_ORIG_OP");t==="Snooze"&&(n[i]=!0,n[r]=!0)}}function u(t){var n=arguments[arguments.length-1];if(n&&n instanceof Object){var r=e.get("SWE_EXTN_RETVAL"),i=e.get("SWE_EXTN_CANCEL_ORIG_OP"),s=this.Get("dispAlarm"),o=this.Get("nextAlarm");if(t==="Next")n[i]=!0,n[r]=s<o-1;else if(t==="Prev")n[i]=!0,n[r]=s>0;else if(t==="SnoozeAll"||t==="DismissAll")n[i]=!0,n[r]=o>1}return!0}function a(e,r,i){var s=arguments[arguments.length-1];if(!e)return!1;switch(e){case"Next":w.call(this),s[t]=!0,s[n]=!1;break;case"Prev":E.call(this),s[t]=!0,s[n]=!1;break;case"SnoozeAlarm":S.call(this),s[t]=!0,s[n]=!1;break;case"SnoozeAll":x.call(this),s[t]=!0,s[n]=!1;break;case"DismissAlarm":T.call(this),s[t]=!0,s[n]=!1;break;case"DismissAll":N.call(this),s[t]=!0,s[n]=!1;break;default:}return!0}function f(e,t,n){return l.call(this,e,n)}function l(e,t){var n=y.call(this.GetPModel()),r="",i=e.GetFieldName();if(n)switch(i){case"Type":r=n.apptType;break;case"Description":r=n.description;break;case"Comment":r=n.apptComment;break;case"MeetingLocation":r=n.apptLocation;break;case"Due Date":r=n.due;break;case"Appt Alarm Time Min":r=n.SnoozeTimeVal;break;case"Alarm":r=this.GetPModel().Get("dispAlarm")+1+" / "+this.GetPModel().Get("nextAlarm");break;default:}return r}function c(e,t){var n=y.call(this.GetPModel()),r=e.GetFieldName();return n&&r==="Appt Alarm Time Min"&&(n.SnoozeTimeVal=t),!0}function h(e,t,n,r,i,s,o,u,a,f,l,c){var h={};return h.actualDate=e,h.actualTime=t,h.endDate=i,h.endTime=s,h.date=new Date(e.slice(6),e.slice(0,2)-1,e.slice(3,5),t.slice(0,2),t.slice(3,5),t.slice(6)),h.apptDate=new Date(h.date),h.date.setTime(h.date.getTime()-a*1e3),h.lead=a,h.description=n,h.apptId=r,h.apptType=o,h.apptRepAct=u,h.SnoozeTimeVal=f>0?f:15,h.apptComment=l,h.apptLocation=c,h.due=e+" "+t.slice(0,5)+" - "+i+" "+s.slice(0,5),h.timerId=-1,h.MsgId="",h}function p(){var e=CCFMiscUtil_CreatePropSet(),t=CCFMiscUtil_CreatePropSet(),n={},r=CCFMiscUtil_CreatePropSet(),i,s,o=SiebelApp.S_App.GetService("Alarm Manager"),u=this;o?(t=null,n.async=!0,n.npr=!1,n.selfbusy=!0,n.scope=this,n.cb=function(){t=arguments[2],r=t.GetChildByType("ResultSet");if(r!==null){s=parseInt(r.GetProperty("strLoadFrequency"),10),s&&(s>35790&&(s=35790),s<0&&(s=2),this.SetProperty("Load Frequency",s));if(r.GetProperty("strSnoozeTimes")!==null){var e=r.GetProperty("strSnoozeTimes").split("|"),n=this.Get("GetControls"),o=CCFMiscUtil_CreatePropSet();for(var a=0;a<e.length;a++){var f=CCFMiscUtil_CreatePropSet();f.SetProperty("DisplayName",e[a]),o.AddChild(f)}n.Snooze.SetRadioGroupPropSet(o)}i=parseInt(r.GetProperty("strLoadDelay"),10),i>0?(i>2147400&&(i=2147400),setTimeout(function(){d.call(u)},i*1e3)):d.call(u)}else setTimeout(function(){d.call(u)},3e4)},o.InvokeMethod("GetDelayInterval",e,n)):this.SetProperty("pollId",setTimeout(function(){d.call(u)},this.Get("Load Frequency")*6e4))}function d(){var e=new Date,t=CCFMiscUtil_CreatePropSet(),n=CCFMiscUtil_CreatePropSet(),r=1500,i={},s=CCFMiscUtil_CreatePropSet();t.SetProperty("alarmDate",e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()),t.SetProperty("now",e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()),t.SetProperty("interval",r),t.SetProperty("SWEJI","false");var o=SiebelApp.S_App.GetService("Alarm Manager"),u=this;o?(n=null,i.async=!0,i.npr=!1,i.selfbusy=!0,i.scope=this,i.cb=function(){n=arguments[2],v.call(this,n)},o.InvokeMethod("GetAlarmInstances",t,i)):this.SetProperty("pollId",setTimeout(function(){d.call(u)},this.Get("Load Frequency")*6e4))}function v(e){var t=CCFMiscUtil_CreatePropSet(),n,r;if(e!==null){t=e.GetChildByType("ResultSet");var i=this.Get("Alarms"),s=i.length;if(t!==null){var o=i.slice(0);i.splice(0,s);var u=t.GetPropertyCount();for(var a=0;a*12<u-1;a++){if(t.GetProperty("apptDate"+a)===null)continue;var f=t.GetProperty("apptDate"+a),l=t.GetProperty("apptTime"+a),c=t.GetProperty("apptDesc"+a),p=t.GetProperty("alarmId"+a),v=t.GetProperty("apptType"+a),g=t.GetProperty("apptEndDate"+a),y=t.GetProperty("apptEndTime"+a),b=t.GetProperty("repAct"+a),w=t.GetProperty("reminder"+a),E=t.GetProperty("defSnoozeTime"+a),S=t.GetProperty("apptComment"+a),x=t.GetProperty("apptLocation"+a);r=h.call(this,f,l,c,p,g,y,v,b,w,E,S,x),i[a]=r;for(var T=0;T<s;T++)if(r.apptId.indexOf(o[T].apptId)!==-1){r.apptDate.getTime()===o[T].apptDate.getTime()&&r.lead===o[T].lead&&r.date.getTime()<o[T].date.getTime()?(i[a].SnoozeTimeVal=o[T].SnoozeTimeVal,i[a].date=o[T].date,i[a].timerId=o[T].timerId,i[a].MsgId=o[T].MsgId):r.date.getTime()===o[T].date.getTime()&&(i[a].timerId=o[T].timerId);break}}}i.length>1&&i.sort(C),this.SetProperty("Alarms",i),m.call(this,!1)}var N=this;this.SetProperty("pollId",setTimeout(function(){d.call(N)},this.Get("Load Frequency")*6e4))}function m(e){var t=0,n=0,r=new Date,i=!1,s=this,o=CCFMiscUtil_CreatePropSet(),u=CCFMiscUtil_CreatePropSet(),a=CCFMiscUtil_CreatePropSet(),f=SiebelApp.S_App.GetMsgBarPM(),l=this.Get("timerId"),c=this.Get("msgId"),h=this.Get("nextAlarm"),p=this.Get("dueAlarm"),d=this.Get("dispAlarm"),v=this.Get("Alarms");!e&&l>0&&(clearTimeout(l),l=-1,h<v.length&&(v[h].timerId=-1));for(n=0;n<v.length&&v[n].date.getTime()<=r.getTime();n++)t++,i?v[n].timerId=0:v[n].timerId<0?(i=!0,v[n].timerId=0,p=n,e=!0):v[n].timerId===l&&(i=!0,p=n);h=n,typeof f!="undefined"&&(a.SetType("Local"),a.SetProperty("Type","Normal"),a.SetProperty("Abstract","((( "+this.Get("GetAppletLabel")+" )))"),a.SetProperty("Callback","PM:"+this.GetObjName()+":RefreshUI"),c.length===0?t>0&&(a.SetProperty("Body",t+" "+this.Get("GetAppletLabel")),o.AddChild(a),u=f.
ExecuteMethod("AddNotification",o),u.GetChildCount()>0&&(c=u.GetChild(0).GetProperty("Msg Id"))):t>0?(a.SetProperty("Msg Id",c),a.SetProperty("Body",t+" alarm pending."),o.AddChild(a),f.ExecuteMethod("UpdateNotification",o)):(a.SetProperty("Msg Id",c),o.AddChild(a),f.ExecuteMethod("DeleteNotification",o),c="")),v.length>0&&h<v.length&&(Math.abs(v[h].date.getTime()-r.getTime())<=21474e6?l=setTimeout(function(){m.call(s,!0)},Math.abs(v[h].date.getTime()-r.getTime())):l=-1,v[h].timerId=l),this.SetProperty("timerId",l),this.SetProperty("msgId",c),this.SetProperty("nextAlarm",h),this.SetProperty("dueAlarm",p),this.SetProperty("Alarms",v),(d<0||d>=h)&&this.SetProperty("dispAlarm",p),this.ExecuteMethod("RefreshUI")}function g(){var e=SiebelAppFacade.ComponentMgr.FindComponent({id:this.GetObjName()});e&&e.Show()}function y(){var e=this.Get("dispAlarm");return e>=0?this.Get("Alarms")[e]:null}function b(e){var t=this.Get("Alarms"),n=this.Get("dispAlarm");t[n].SnoozeTimeVal=e,this.SetProperty("Alarms",t)}function w(){var e=this.Get("dispAlarm");e<this.Get("nextAlarm")&&(e++,this.SetProperty("dispAlarm",e)),this.ExecuteMethod("RefreshUI")}function E(){var e=this.Get("dispAlarm");e>0&&(e--,this.SetProperty("dispAlarm",e)),this.ExecuteMethod("RefreshUI")}function S(){var e=SiebelApp.S_App.GetService("Alarm Manager"),t=SiebelApp.S_App.NewPropertySet(),n=this.Get("dispAlarm"),r=this.Get("Alarms"),i;t.SetProperty("alarmId",r[n].apptId),t.SetProperty("snoozeValue",r[n].SnoozeTimeVal),t.SetProperty("snoozeUnit","60"),t.SetProperty("SWEJSXInfo","false"),r[n].timerId=-1,r[n].date.setTime((new Date).getTime()+r[n].SnoozeTimeVal*60*1e3),n+1===this.Get("nextAlarm")&&n>0&&(n--,this.SetProperty("dispAlarm",n));if(e){i=null;var s="SnoozeAlarm",o={};o.async=!0,o.selfbusy=!0,o.scope=this,o.cb=function(){m.call(this,!1)},e.InvokeMethod(s,t,o)}r.sort(C),this.SetProperty("Alarms",r),m.call(this,!1)}function x(){var e="",t=SiebelApp.S_App.GetService("Alarm Manager"),n=SiebelApp.S_App.NewPropertySet(),r=this.Get("Alarms"),i=this.Get("dispAlarm");for(var s=0;s<this.Get("nextAlarm");s++)r[s].SnoozeTimeVal=r[i].SnoozeTimeVal,r[s].date.setTime((new Date).getTime()+r[s].SnoozeTimeVal*60*1e3),r[s].timerId=-1,e+=r[s].apptId+"|";n.SetProperty("alarmId",e),n.SetProperty("snoozeValue",r[i].SnoozeTimeVal),n.SetProperty("snoozeUnit","60"),n.SetProperty("SWEJSXInfo","false");if(t){outPropSet=null;var o="SnoozeAllAlarms",u={};u.async=!0,u.selfbusy=!0,u.scope=this,u.cb=function(){m.call(this,!1)},t.InvokeMethod(o,n,u)}r.sort(C),this.SetProperty("Alarms",r),m.call(this,!1)}function T(){var e=SiebelApp.S_App.GetService("Alarm Manager"),t=SiebelApp.S_App.NewPropertySet(),n=this.Get("dispAlarm"),r=this.Get("Alarms"),i;t.SetProperty("alarmId",r[n].apptId),t.SetProperty("SWEJSXInfo","false"),r.splice(n,1);if(e){i=null;var s="DismissAlarmInstance",o={};o.async=!0,o.selfbusy=!0,o.scope=this,o.cb=function(){m.call(this,!1)},e.InvokeMethod(s,t,o)}this.SetProperty("Alarms",r),m.call(this,!1)}function N(){var e="",t=SiebelApp.S_App.GetService("Alarm Manager"),n=SiebelApp.S_App.NewPropertySet(),r=this.Get("nextAlarm"),i=this.Get("Alarms");for(var s=0;s<r;s++)e+=i[s].apptId+"|";n.SetProperty("alarmId",e),n.SetProperty("SWEJSXInfo","false");if(t){outPropSet=null;var o="DismissAllAlarms",u={};u.async=!0,u.selfbusy=!0,u.scope=this,u.cb=function(){m.call(this,!1)},t.InvokeMethod(o,n,u)}i.splice(0,r),this.SetProperty("Alarms",i),m.call(this,!1)}function C(e,t){return e.date.valueOf()>t.date.valueOf()?1:e.date.valueOf()<t.date.valueOf()?-1:0}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=e.get("SWE_EXTN_CANCEL_ORIG_OP"),n=e.get("SWE_EXTN_RETVAL"),r=e.get("SWE_EXTN_STOP_PROP_OP");return SiebelJS.Extend(i,SiebelAppFacade.PresentationModel),i.prototype.Init=function(){SiebelAppFacade.AlarmMgrPM.superclass.Init.call(this,arguments),this.AddProperty("Alarms",[]),this.AddProperty("pollId",""),this.AddProperty("timerId",-1),this.AddProperty("msgId",""),this.AddProperty("nextAlarm",0),this.AddProperty("dueAlarm",-1),this.AddProperty("dispAlarm",-1),this.AddProperty("Load Frequency",2),this.AddMethod("prev",E),this.AddMethod("next",w),this.AddMethod("GetAlarm",y),this.AddMethod("DismissAlarm",T),this.AddMethod("DismissAll",N),this.AddMethod("SetSnooze",b),this.AddMethod("SnoozeAlarm",S),this.AddMethod("SnoozeAll",x),this.AddMethod("CanUpdate",o,{scope:this,sequence:!0}),this.AddMethod("CanInvokeMethod",u,{scope:this,sequence:!0}),this.AddMethod("InvokeMethod",a,{scope:this,sequence:!0}),this.AddMethod("GetFieldValue",l,{core:!0,override:!0,scope:this}),this.AddMethod("GetFormattedFieldValue",f,{core:!0,override:!0,scope:this}),this.AddMethod("SetFormattedValue",c,{core:!0,override:!0,scope:this}),this.AddMethod("RefreshUI",g),this.AddMethod("notifyAlarm",s),this.AttachEventHandler(e.get("PHYEVENT_APPLET_FOCUS"),function(){var e=arguments[arguments.length-1];return e[t]=!0,e[r]=!0,!1})},i.prototype.Setup=function(e){SiebelAppFacade.AlarmMgrPM.superclass.Setup.call(this,e),p.call(this)},i}(),SiebelAppFacade.AlarmMgrPM}));
